{% extends 'layout.html' %}
{% block content %}
  <h1>Auto Scan</h1>
  <form method="post" enctype="multipart/form-data" class="mb-4">
    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
    <input type="file" name="statement" multiple required>
    <button class="btn btn-primary" type="submit">Scan</button>
  </form>
  {% if results %}
  <h2>Recurring Expenses</h2>
  <form method="post">
    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
  <table class="table table-bordered">
    <thead>
      <tr><th></th><th>Description</th><th>Amount</th></tr>
    </thead>
    <tbody>
    {% for desc, amt in results %}
      <tr>
        <td class="text-center">
          <input type="checkbox" name="add_{{ loop.index0 }}" class="form-check-input shadow-sm" checked>
          <input type="hidden" name="desc_{{ loop.index0 }}" value="{{ desc }}">
          <input type="hidden" name="amt_{{ loop.index0 }}" value="{{ amt }}">
        </td>
        <td>{{ desc }}</td>
        <td>{{ amt|fmt }}</td>
      </tr>
    {% endfor %}
    </tbody>
  </table>
  <button class="btn btn-primary" type="submit">Save</button>
  </form>
  {% else %}
    <p>No recurring expenses found.</p>
  {% endif %}
  <h2 class="mt-4">Saved Monthly Expenses</h2>
  <table class="table table-bordered">
    <thead>
      <tr><th>Description</th><th>Amount</th><th></th></tr>
    </thead>
    <tbody>
    {% for desc, amt in monthly_expenses %}
      <tr>
        <td>{{ desc }}</td>
        <td>{{ amt|fmt }}</td>
        <td>
          <form method="post" action="{{ url_for('delete_monthly_expense_route', desc=desc) }}">
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
            <button class="btn btn-sm btn-danger">Delete</button>
          </form>
        </td>
      </tr>
    {% else %}
      <tr><td colspan="3">No monthly expenses saved.</td></tr>
    {% endfor %}
    </tbody>
  </table>
</div>
{% endblock %}
